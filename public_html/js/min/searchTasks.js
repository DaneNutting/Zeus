$(document).ready(function(){$.ajax({dataType:"json",url:"../php/TaskDropDown.php",success:function load(result){populateDropDowns(result);}});});function populateDropDowns(results){var getUrlParameter=function getUrlParameter(sParam){var sPageURL=decodeURIComponent(window.location.search.substring(1)),sURLVariables=sPageURL.split('&'),sParameterName,i;for(i=0;i<sURLVariables.length;i++){sParameterName=sURLVariables[i].split('=');if(sParameterName[0]===sParam){return sParameterName[1]===undefined?true:sParameterName[1];}}};var taskIDFromURL=getUrlParameter("taskId");var sprint=$("#sprints");var state=$("#pbiState");var phpSprintValues=[];var phpStateValues=[];var phpPbiTitles=[];var phpAssignees=[];var assigneeArray=[];var pbiTitleArray=[];$.each(results,function(key,value){phpSprintValues=value[0];phpStateValues=value[1];phpPbiTitles=value[2];phpAssignees=value[3];});$.each(phpSprintValues,function(key,value){sprint.append('<option value="'+value.IterationName+'">'+value.IterationName+'</option>')})
$.each(phpSprintValues,function(key,value){$("#taskIteration").append('<option value="'+value.IterationName+'">'+value.IterationName+'</option>')})
$.each(phpStateValues,function(key,value){state.append('<option value="'+value.State+'">'+value.State+'</option>')})
$.each(phpStateValues,function(key,value){$("#taskDetailState").append('<option value="'+value.State+'">'+value.State+'</option>')})
$.each(phpAssignees,function(key,value){var assigneeName=value.assigneeResult
assigneeArray.push(assigneeName);});$.each(phpPbiTitles,function(key,value){var pbiTitle=value.pbiTitleResult
pbiTitleArray.push(pbiTitle);});var assignees=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,local:assigneeArray});$('#assignee').typeahead({hint:true,highlight:true,minLength:1},{source:assignees});var pbiTitle=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,local:pbiTitleArray});$('#pbiTitle').typeahead({hint:true,highlight:true,minLength:1},{source:pbiTitle});if(taskIDFromURL!=null){$.ajax({type:"POST",url:"../php/TaskDetails.php",data:{postedTaskID:taskIDFromURL,},dataType:"json",success:function createPBIDetails(pbiData){PBIDetails(pbiData);},error:function(){console.log('error')}});};$("#pbiSearch").click(function(e){e.preventDefault();$.ajax({type:"POST",url:"../php/SearchTasks.php",data:{postedSprint:sprint.val(),postedState:state.val()},dataType:"json",success:function createPBITable(pbis){PBI(pbis);},error:function(){console.log('error')}});});return false;function PBI(results){var taskID=[];var taskTitle=[];var table=document.getElementById('pBIResultstable')
var rows=table.getElementsByTagName('tr').length;var clickedPBIID;if(rows>1){for(i=rows-1;i>0;i--){table.deleteRow(i);}}else{}$.each(results,function(key,value){var a=value.taskId;var b=value.taskTitle;taskID.push(a);taskTitle.push(b);});for(i=0;i<results.length;i++){$("#pBIResultstable").append('<tr class="PBI">'+'<td>'+taskID[i]+'</td>'+'<td>'+taskTitle[i]+'</td>'+'</tr>');};$(".PBI").click(function(e){e.preventDefault();var clickedTaskID=e.target.parentNode.firstChild.textContent;$.ajax({type:"POST",url:"../php/TaskDetails.php",data:{postedTaskID:clickedTaskID,},dataType:"json",success:function createPBIDetails(pbiData){PBIDetails(pbiData);},error:function(){console.log('error')}});});return false;};function PBIDetails(results){var taskIDField=document.getElementById("taskID");var taskTitleField=document.getElementById("taskTitle");var pbiTitleField=document.getElementById("pbiTitle");var assigneeField=document.getElementById("assignee");var taskDescField=document.getElementById("taskDescription");var estimatedTimeField=document.getElementById("estimatedTime");var timeSpentField=document.getElementById("timeSpent");var taskStateField=document.getElementById("taskDetailState");var taskIterationField=document.getElementById("taskIteration");$('#pbiDetails').velocity({opacity:1},{duration:200});$('#pbiDetailsButton').show();$('#pbiDetailsButton').css("visibility","visible");$('#pbiDetailsButton').velocity({opacity:1},{duration:0});$('#deletePbiButton').show();$('#deletePbiButton').css("visibility","visible");$('#deletePbiButton').velocity({opacity:1},{duration:0});$('#createPBI').hide();$('#createPBI').css("visibility","hidden");$('#createPBI').velocity({opacity:0},{duration:0});$.each(results,function(key,value){taskIDField.value=value.taskId;taskTitleField.value=value.taskTitle;pbiTitleField.value=value.pbiTitle;assigneeField.value=value.assignee;taskDescField.value=value.taskDesc;estimatedTimeField.value=value.taskEstTime;timeSpentField.value=value.taskHoursDone;taskStateField.value=value.state;taskIterationField.value=value.itName;})};};